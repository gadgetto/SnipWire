/**
 * jquery.repeater
 *
 * https://github.com/DubFriend/jquery.repeater
 * (MIT) 09-10-2016
 * Brian Detering <BDeterin@gmail.com> (http://www.briandetering.net/)
 *
 * @version 1.2.1 (jquery.repeater origin)
 *
 * ---
 *
 * jquery.input
 *
 * https://github.com/DubFriend/jquery.input
 * (MIT) 09-08-2015
 * Brian Detering <BDeterin@gmail.com> (http://www.briandetering.net/)
 *
 * @version 0.0.1 (jquery.input origin)
 *
 * ---
 *
 * Enhancements, changes and fixes by
 * Martin Gartner <martin.gartner@bitego.com> (http://www.bitego.com)
 *
 *  - 2019-05-29 removed support for nested repeaters
 *  - 2019-05-31 changed method to prevent deletion of last available item
 *  - 2019-05-31 added Support for input type="number"
 *  - 2019-06-02 added support for sorting repeater items via drag & drop (requires jQueryUI)
 *
 * @preserve
 */
!function(t){"use strict";var n=function(t){return t},e=function(n){return t.isArray(n)},i=function(t){return!e(t)&&t instanceof Object},u=function(n,e){return t.inArray(e,n)},r=function(t,n){for(var e in t)t.hasOwnProperty(e)&&n(t[e],e,t)},a=function(t){return t[t.length-1]},c=function(t,n,i){return e(t)?function(t,n){var e=[];return r(t,function(t,i,u){e.push(n(t,i,u))}),e}(t,n):function(t,n,e){var i={};return r(t,function(t,u,r){u=e?e(u,t):u,i[u]=n(t,u,r)}),i}(t,n,i)},o=function(t,n,e){return c(t,function(t,i){return t[n].apply(t,e||[])})};!function(t){var n=function(t,n){var e,i,a,c=(i={},(e=e||{}).publish=function(t,n){r(i[t],function(t){t(n)})},e.subscribe=function(t,n){i[t]=i[t]||[],i[t].push(n)},e.unsubscribe=function(t){r(i,function(n){var e=u(n,t);-1!==e&&n.splice(e,1)})},e),o=t.$;return c.getType=function(){throw'implement me (return type. "text", "radio", etc.)'},c.$=function(t){return t?o.find(t):o},c.disable=function(){c.$().prop("disabled",!0),c.publish("isEnabled",!1)},c.enable=function(){c.$().prop("disabled",!1),c.publish("isEnabled",!0)},n.equalTo=function(t,n){return t===n},n.publishChange=function(t,e){var i=c.get();n.equalTo(i,a)||c.publish("change",{e:t,domElement:e}),a=i},c},c=function(t,e){var i=n(t,e);return i.get=function(){return i.$().val()},i.set=function(t){i.$().val(t)},i.clear=function(){i.set("")},e.buildSetter=function(t){return function(n){t.call(i,n)}},i},f=function(t,n){t=e(t)?t:[t],n=e(n)?n:[n];var i=!0;return t.length!==n.length?i=!1:r(t,function(t){(function(t,n){return-1!==u(t,n)})(n,t)||(i=!1)}),i},p=function(t){var n={},e=c(t,n);return e.getType=function(){return"button"},e.$().on("change",function(t){n.publishChange(t,this)}),e},l=function(n){var i={},u=c(n,i);return u.getType=function(){return"checkbox"},u.get=function(){var n=[];return u.$().filter(":checked").each(function(){n.push(t(this).val())}),n},u.set=function(n){n=e(n)?n:[n],u.$().each(function(){t(this).prop("checked",!1)}),r(n,function(t){u.$().filter('[value="'+t+'"]').prop("checked",!0)})},i.equalTo=f,u.$().change(function(t){i.publishChange(t,this)}),u},s=function(t){var n=k(t,{});return n.getType=function(){return"email"},n},h=function(e){var i={},u=n(e,i);return u.getType=function(){return"file"},u.get=function(){return a(u.$().val().split("\\"))},u.clear=function(){this.$().each(function(){t(this).wrap("<form>").closest("form").get(0).reset(),t(this).unwrap()})},u.$().change(function(t){i.publishChange(t,this)}),u},d=function(t){var n={},e=c(t,n);return e.getType=function(){return"hidden"},e.$().change(function(t){n.publishChange(t,this)}),e},g=function(e){var i={},u=n(e,i);return u.getType=function(){return"file[multiple]"},u.get=function(){var t,n=u.$().get(0).files||[],e=[];for(t=0;t<(n.length||0);t+=1)e.push(n[t].name);return e},u.clear=function(){this.$().each(function(){t(this).wrap("<form>").closest("form").get(0).reset(),t(this).unwrap()})},u.$().change(function(t){i.publishChange(t,this)}),u},m=function(t){var n={},i=c(t,n);return i.getType=function(){return"select[multiple]"},i.get=function(){return i.$().val()||[]},i.set=function(t){i.$().val(""===t?[]:e(t)?t:[t])},n.equalTo=f,i.$().change(function(t){n.publishChange(t,this)}),i},v=function(t){var n=k(t,{});return n.getType=function(){return"password"},n},y=function(n){var e={},i=c(n,e);return i.getType=function(){return"radio"},i.get=function(){return i.$().filter(":checked").val()||null},i.set=function(n){n?i.$().filter('[value="'+n+'"]').prop("checked",!0):i.$().each(function(){t(this).prop("checked",!1)})},i.$().change(function(t){e.publishChange(t,this)}),i},b=function(t){var n={},e=c(t,n);return e.getType=function(){return"range"},e.$().change(function(t){n.publishChange(t,this)}),e},$=function(t){var n={},e=c(t,n);return e.getType=function(){return"select"},e.$().change(function(t){n.publishChange(t,this)}),e},k=function(t){var n={},e=c(t,n);return e.getType=function(){return"text"},e.$().on("change keyup keydown",function(t){n.publishChange(t,this)}),e},x=function(t){var n={},e=c(t,n);return e.getType=function(){return"number"},e.$().on("change keyup keydown",function(t){n.publishChange(t,this)}),e},w=function(t){var n={},e=c(t,n);return e.getType=function(){return"textarea"},e.$().on("change keyup keydown",function(t){n.publishChange(t,this)}),e},T=function(t){var n=k(t,{});return n.getType=function(){return"url"},n},C=function(n){var e={},a=n.$,c=n.constructorOverride||{button:p,text:k,number:x,url:T,email:s,password:v,range:b,textarea:w,select:$,"select[multiple]":m,radio:y,checkbox:l,file:h,"file[multiple]":g,hidden:d},o=function(n,u){(i(u)?u:a.find(u)).each(function(){var i=t(this).attr("name");e[i]=c[n]({$:t(this)})})},f=function(n,o){var f=[],p=i(o)?o:a.find(o);i(o)?e[p.attr("name")]=c[n]({$:p}):(p.each(function(){-1===u(f,t(this).attr("name"))&&f.push(t(this).attr("name"))}),r(f,function(t){e[t]=c[n]({$:a.find('input[name="'+t+'"]')})}))};return a.is("input, select, textarea")?a.is('input[type="button"], button, input[type="submit"]')?o("button",a):a.is("textarea")?o("textarea",a):a.is('input[type="text"]')||a.is("input")&&!a.attr("type")?o("text",a):a.is('input[type="number"]')?o("number",a):a.is('input[type="password"]')?o("password",a):a.is('input[type="email"]')?o("email",a):a.is('input[type="url"]')?o("url",a):a.is('input[type="range"]')?o("range",a):a.is("select")?a.is("[multiple]")?o("select[multiple]",a):o("select",a):a.is('input[type="file"]')?a.is("[multiple]")?o("file[multiple]",a):o("file",a):a.is('input[type="hidden"]')?o("hidden",a):a.is('input[type="radio"]')?f("radio",a):a.is('input[type="checkbox"]')?f("checkbox",a):o("text",a):(o("button",'input[type="button"], button, input[type="submit"]'),o("text",'input[type="text"]'),o("number",'input[type="number"]'),o("password",'input[type="password"]'),o("email",'input[type="email"]'),o("url",'input[type="url"]'),o("range",'input[type="range"]'),o("textarea","textarea"),o("select","select:not([multiple])"),o("select[multiple]","select[multiple]"),o("file",'input[type="file"]:not([multiple])'),o("file[multiple]",'input[type="file"][multiple]'),o("hidden",'input[type="hidden"]'),f("radio",'input[type="radio"]'),f("checkbox",'input[type="checkbox"]')),e};t.fn.inputVal=function(n){var e=t(this),i=C({$:e});return e.is("input, textarea, select")?void 0===n?i[e.attr("name")].get():(i[e.attr("name")].set(n),e):void 0===n?o(i,"get"):(r(n,function(t,n){i[n].set(t)}),e)},t.fn.inputOnChange=function(n){var e=t(this),i=C({$:e});return r(i,function(t){t.subscribe("change",function(t){n.call(t.domElement,t.e)})}),e},t.fn.inputDisable=function(){var n=t(this);return o(C({$:n}),"disable"),n},t.fn.inputEnable=function(){var n=t(this);return o(C({$:n}),"enable"),n},t.fn.inputClear=function(){var n=t(this);return o(C({$:n}),"clear"),n}}(jQuery),t.fn.repeaterVal=function(){var n,e,i=function(t){if(1===t.length&&(0===t[0].key.length||1===t[0].key.length&&!t[0].key[0]))return t[0].val;r(t,function(t){t.head=t.key.shift()});var n,e=function(){var n={};return r(t,function(t){n[t.head]||(n[t.head]=[]),n[t.head].push(t)}),n}();return/^[0-9]+$/.test(t[0].head)?(n=[],r(e,function(t){n.push(i(t))})):(n={},r(e,function(t,e){n[e]=i(t)})),n};return i((n=t(this).inputVal(),e=[],r(n,function(t,n){var i=[];"undefined"!==n&&(i.push(n.match(/^[^\[]*/)[0]),i=i.concat(c(n.match(/\[[^\]]*\]/g),function(t){return t.replace(/[\[\]]/g,"")})),e.push({val:t,key:i}))}),e))},t.fn.repeater=function(i){var u;i=i||{};return t(this).each(function(){var o=t(this),f=i.show||function(){t(this).show()},p=i.hide||function(t){t()},l=o.find("[data-repeater-list]"),s=function(){return l.find("[data-repeater-item]")},h=l.find("[data-repeater-item]").first().clone().hide(),d=function(){i.singleItemUndeletable&&s().length<=1?l.find("[data-repeater-delete]").hide():l.find("[data-repeater-delete]").show()},g=function(){var t=l.data("repeater-list");return i.$parent?i.$parent.data("item-name")+"["+t+"]":t},m=function(n,e){n.each(function(n){var i=t(this);i.data("item-name",e+"["+n+"]"),i.find("[name]").each(function(){var i=t(this),u=i.attr("name").match(/\[[^\]]+\]/g),r=u?a(u).replace(/\[|\]/g,""):i.attr("name"),c=e+"["+n+"]["+r+"]"+(i.is(":checkbox")||i.attr("multiple")?"[]":"");i.attr("name",c)})}),l.find("input[name][checked]").removeAttr("checked").prop("checked",!0)};m(s(),g()),i.initEmpty&&s().remove(),i.ready&&i.ready(function(){m(s(),g())});i.sortable&&function(){return void 0!==jQuery.ui}&&l.sortable({axis:"y",cursor:"move",opacity:.7,helper:function(n,e){return e.children().each(function(){t(this).width(t(this).width())}),e},stop:function(t,n){m(s(),g())}});var v,y=(v=function(u,a){if(a||i.defaultValues){var o={};u.find("[name]").each(function(){var n=t(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];o[n]=t(this).attr("name")}),u.inputVal(c((f=a||i.defaultValues,p=function(t,n){return o[n]},e(f)?(l=[],r(f,function(t,n,e){p(t,n,e)&&l.push(t)})):(l={},r(f,function(t,n,e){p(t,n,e)&&(l[n]=t)})),l),n,function(t){return o[t]}))}var f,p,l},function(n,e){l.append(n),m(s(),g()),n.find("[name]").each(function(){t(this).inputClear()}),v(n,e||i.defaultValues)}),b=function(t){var n=h.clone();y(n,t),f.call(n.get(0)),d()};u=function(t){s().remove(),r(t,b)},o.find("[data-repeater-create]").click(function(){b()}),l.on("click","[data-repeater-delete]",function(){var n=t(this).closest("[data-repeater-item]").get(0);p.call(n,function(){t(n).remove(),m(s(),g()),d()})})}),this.setList=u,this}}(jQuery);