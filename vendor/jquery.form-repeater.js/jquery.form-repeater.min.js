/**
 * jQuery Form Repeater Plugin 0.1.0
 *
 * Copyright (c) 2011 Corey Ballou
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
!function(t){function e(e){var n=e.data,o=n.repeatCount+1,a=n.groupClone.clone();return t.isFunction(n.opts.beforeAdd)&&(a=n.opts.beforeAdd.call(this,a)),n.opts.maxItems>0&&n.repeatCount==n.opts.maxItems?(alert("You have hit the maximum allowable items."),!1):(r(a,o,n),n.repeatCount>=n.opts.minItems-1&&a.find("."+n.opts.btnRemoveClass).show(),"append"==n.opts.repeatMode?a.appendTo(n):"prepend"==n.opts.repeatMode?a.prependTo(n):"insertAfterLast"==n.opts.repeatMode&&a.insertAfter(n.find("."+n.opts.groupClass).last()),n.repeatCount++,t.isFunction(n.opts.afterAdd)&&n.opts.afterAdd.call(this,a),!1)}function n(e){var n=t(this),o=e.data,r=o.find("."+o.opts.groupClass);if(r.length<=o.opts.minItems)return!1;if(!(s=n.closest("."+o.opts.groupClass)).length)if("append"==o.opts.repeatMode)var s=r.filter(":last");else if("prepend"==o.opts.repeatMode)s=r.filter(":first");else if("insertAfterLast"==o.opts.repeatMode)s=r.filter(":last");return s.length&&(o.opts.animation?"slide"==o.opts.animation?s.slideUp(o.opts.animationSpeed,o.opts.animationEasing,function(){a(s,o)}):"fade"==o.opts.animation?s.fadeOut(o.opts.animationSpeed,o.opts.animationEasing,function(){a(s,o)}):"object"==typeof o.opts.animation&&s.animate(o.opts.animation,o.opts.animationSpeed,o.opts.animationEasing,function(){a(s,o)}):a(s,o)),!1}function o(t,e,n,o){var a=e;if(n=parseInt(n),t){if(t.indexOf("+=")>-1){var r=t.match(/\+=(\d+)/i);if(r&&r.length&&r[1]){var s=parseInt(r[1]);a=t.replace(/\+=(\d)+/i,o.opts.startingIndex+n+s)}}t.indexOf("++")>-1&&(a=t.replace(/\+\+/gi,o.opts.startingIndex+n))}return a}function a(e,n){t.isFunction(n.opts.beforeDelete)&&n.opts.beforeDelete.call(this,e),e.remove(),"number"==typeof n.repeatCount&&n.repeatCount--,n.opts.reindexOnDelete&&function(e){var n=e.find("."+e.opts.groupClass),o=e.opts.startingIndex;n.each(function(){r(t(this),o,e),o++})}(n),t.isFunction(n.opts.afterDelete)&&n.opts.afterDelete.call(this,e)}function r(e,n,a){var r,s,i,p,l,d,u,f,m=e.find(":input");return m.length&&m.each(function(){f=t(this),(r=f.data("pattern-name"))&&(l=f.attr("name"),l=o(r,l,n,a),f.attr("name",l),(f.is('input[type="checkbox"]')||f.is('input[type="radio"]'))&&(f.prop("checked")?f.attr("checked",!0):f.attr("checked",!1))),(s=f.data("pattern-id"))&&(p=f.attr("id"),p=o(s,p,n,a),f.attr("id",p)),(d=e.find("label[for="+f.attr("id")+"]")).length||(d=f.parent("label")),d.length||(d=f.siblings("label")),d.length&&(d=d.eq(0),i=d.data("pattern-text"),(u=d.html())&&(u=o(i,u,n,a),d.html(u)),d.attr("for")&&p&&d.attr("for",p))}),e}t.fn.repeater=function(a,s){var i,p,l,d,u,f,m,c,h,g,b,C,v=t(this);if(v.opts=t.extend({},t.fn.repeater.defaults,a),v.repeatCount=0,!v.find("."+v.opts.btnAddClass).length)return alert("You must specify a valid jQuery selector for the add button option in Form Repeater."),!1;if(v.group=t("."+v.opts.groupClass),!v.group.length)return alert("You must specify a valid jQuery selector for the form element grouping option in Form Repeater."),!1;if((i=v.group.find("."+v.opts.btnRemoveClass)).length?i.hide():(i=t('<button type="button" name="rBtnRemove" class="'+v.opts.btnRemoveClass+'" style="display:none" />')).appendTo(v),v.group=v.group.eq(0),v.groupClone=v.group.clone(),0===v.opts.minItems&&(v.group.remove(),v.repeatCount--),v.on("click","."+v.opts.btnRemoveClass,v,n),v.on("click","."+v.opts.btnAddClass,v,e),s&&s.length&&s.forEach(function(e,n){b=r(b=v.groupClone.clone(),n,v),t.isFunction(v.opts.beforeAdd)&&(b=v.opts.beforeAdd.call(this,b)),(C=b.find(":input")).length&&C.each(function(){c=t(this),h=c.attr("name"),void 0!==s[n][h]?c.is('input[type="checkbox"]')?""!==s[n][h]&&"1"!==s[n][h]||c.attr("checked",!0):c.val(s[n][h]):c.is('input[type="checkbox"]')?c.attr("checked",!1):c.val(""),(p=c.data("pattern-name"))&&(f=c.attr("name"),f=o(p,f,n,v),c.attr("name",f)),(l=c.data("pattern-id"))&&(u=c.attr("id"),u=o(l,u,n,v),c.attr("id",u)),(g=b.find("label[for="+c.attr("id")+"]")).length||(g=c.parent("label")),g.length||(g=c.siblings("label")),g.length&&(g=g.eq(0),d=g.data("pattern-text"),(m=g.html())&&(m=o(d,m,n,v),g.html(m)),g.attr("for")&&u&&g.attr("for",u))}),"append"==v.opts.repeatMode?b.appendTo(v):"prepend"==v.opts.repeatMode?b.prependTo(v):"insertAfterLast"==v.opts.repeatMode&&b.insertAfter(v.find("."+v.opts.groupClass).last()),v.group&&(v.group.remove(),v.group=null),v.repeatCount=v.find("."+v.opts.groupClass).length-1,v.repeatCount>v.opts.minItems-1&&b.find("."+v.opts.btnRemoveClass).show(),t.isFunction(v.opts.afterAdd)&&v.opts.afterAdd.call(this,b)}),!0===v.opts.showMinItemsOnLoad&&v.repeatCount<v.opts.minItems-1)for(;v.repeatCount<v.opts.minItems-1;)t("."+v.opts.btnAddClass,v).trigger("click");return this}}(jQuery),$.fn.repeater.defaults={groupClass:"r-group",btnAddClass:"r-btnAdd",btnRemoveClass:"r-btnRemove",minItems:1,maxItems:0,startingIndex:0,reindexOnDelete:!0,showMinItemsOnLoad:!1,repeatMode:"insertAfterLast",animation:null,animationSpeed:400,animationEasing:"swing",clearValues:!0,beforeAdd:function(t){return t},afterAdd:function(t){},beforeDelete:function(t){},afterDelete:function(){}};